  
【スクリプト概要】
	
	・名  称：Lunalys
	・種  別：アクセス解析
	・言  語：PHP
	・配布元：http://act.st/
	・配布日：2016/10/12
	・ｖｅｒ：2.3.0
	
 ======================================================================

 ///// 設置方法 /////
	
	
【設定ファイルの変更】
	
	以下のファイルを「メモ帳」などのテキストエディタで開いて
	編集し、上書き保存して下さい。
	
	
	・ログインID設定：「lunalys/analyzer/configs/pass.ini」
		
		「ユーザー名 = "パスワード"」という形で「=」を挟んで左右に書いて下さい。
		使用出来る文字は英数字のみです。改行を入れて複数設定する事も可能です。
		
		
	・オプション設定：「lunalys/analyzer/configs/conf.ini」
		
		「設定名 = "値"」という形で書いてありますので、
		「=」を挟んで右側の値のみ書き換えて下さい。
		  
		  
【アップロード】
	
	ダウンロードしたファイルをFTPソフトで全てアップロードして下さい。
	その際、ディレクトリ名、ディレクトリ構成は変えないで下さい。
	
	
【パーミッション（アクセス権）変更】
	
	「lunalys/data/」ディレクトリのパーミッション（アクセス権）を
	FTPソフトで「707」もしくは「777」に設定して下さい。
	サーバー屋さんからの指定がある場合はそれに従って下さい。
	
	
【スクリプトの動作確認】
	
	管理画面のURLは「lunalys/analyzer/index.php」になります。
	スマホ用のURLは「lunalys/analyzer/index.php/sp/」です。
	ブラウザでアクセスして正しく表示されるか確認して下さい。
	
	ログイン画面が表示されますので、設定したユーザー名と
	パスワードを入力し「ログイン」ボタンを押して下さい。
	
	
【解析ページへの専用タグの記述】
	
	管理画面の右メニューにある「解析用タグ情報」のリンクを開いて下さい。
	各種タグ情報が表示されますので、解析したいページの
	HTMLファイルもしくはPHPファイルにタグを貼り付けて上書きして下さい。
	
 ----------------------------------------------------------------------
	
【解析対象ページのドメイン設定】
	
	conf.iniのドメイン設定は初期設定のまま（空欄）でも動きますが
	設定しないとドメインのチェックをせず、リファラスパムや
	対象ページ外からのアクセスを素通りさせることになります。
	
	具体的には対象ページにリンクを張ってない不正なリンク元や
	対象ページのHTMLを利用（加工）した外部サイトのページが
	自分のページとして記録されてしまう可能性があります。
	
	そういう問題を防ぐため、面倒ですが出来るだけ設定して下さい。
	
	[例：サイトURLが http://www.example.jp/ の場合]
	
	  domain = "example.jp"  ※サブドメインは不要です
	
 ----------------------------------------------------------------------
	
【データ取得方法の違い】
	
	このスクリプトはデータを取得する方法が2種類あり、
	それぞれにメリット、デメリットがあります。
	
	
	[1:HTMLコードに <script> タグを記述]
	
	・どんなページでもデータを取得出来る
	・データ取得精度は普通（取得漏れの可能性がある）
	・JavaScript＆画像OFF設定だとデータを取得出来ない
	・SPAMロボットのデータを拾う可能性が低い
	・古い携帯だとアクセスページを取得出来ない
	 （タグに各ページのURLを記述すれば取得可）
	
	
	[2:PHPコードに include() を記述]
	
	・PHPのページのみデータを取得出来る
	・データ取得精度は高い（取得漏れが少ない）
	・JavaScript＆画像OFF設定でもデータを取得出来る
	・SPAMロボットのデータを拾う可能性がある
	・古い携帯でもアクセスページを取得出来る
	
 ----------------------------------------------------------------------
	
【別ドメイン用管理者Cookieの発行】
	
	このスクリプトは管理画面にログインした際に
	「管理者Cookie」を発行しています。自分のアクセスをカウントしない、
	という設定の場合「管理者Cookie」が保存されているかで判断しています。
	
	Cookieはドメインごとに管理される仕組みのため、
	解析対象ページとは違うドメインに設置した場合、解析対象ページの
	ドメインで「管理者Cookie」を発行する必要があります。
	
	「lunalys/analyzer/cookie.php」というファイルを
	「メモ帳」などのテキストエディタで編集、上書き保存し
	このファイルのみFTPソフトで解析対象ページのドメイン内に
	アップロードして下さい。
	
	「$execute = 0;」 ⇒ 「$execute = 1;」
	
	ブラウザで設置したcookie.phpにアクセスした後、
	FTPソフトでこのファイルのみ削除して下さい。
	
 ----------------------------------------------------------------------
	
【.htaccessファイルの扱い】
	
	このスクリプトは設定ファイルへのアクセス制限、動作速度向上に
	「.htaccess」という特殊なファイルを利用しています。
	
	ご利用のサーバーによってはセキュリティの関係上「.htaccess」の設置が
	出来なかったり、特定の記述のみ許可しているケースがあります。
	
	もしスクリプトの設置の際に、エラーの原因になる場合は
	削除もしくは変更しても構いません。特に問題なく動作します。
	
 ----------------------------------------------------------------------
	
【ログデータのバックアップ】
	
	ログデータは「lunalys/data/」ディレクトリに「～.db」という
	ファイルで保存されます。FTPソフトでダウンロードするだけで
	簡単にバックアップが取れます。
	
	また「～.db」ファイルをサーバーから削除したとしても、
	同ディレクトリにアップロードすれば再び読み込むことが可能です。
	
	※アップロードした「～.db」ファイルはFTPソフトで
	  パーミッションを「606」もしくは「666」に変更して下さい。
	
 ----------------------------------------------------------------------
	
【ログデータのコンバート】
	
	ver 2.2.x から ver 2.3.x にアップグレードする場合、
	ログの形式が変更になっているためデータを変換する必要があります。
	
	管理画面の右メニューにある「ログデータ管理」のリンクを開き、
	「ログテーブルのコンバート」にある「変換」ボタンを押下して下さい。
	
	
 ======================================================================
	
 ///// インフォメーション /////
	
	
【動作確認環境】
	
	Windows 7  Apache 2.2.22  PHP 5.6.25
	
	IE 11.0  Firefox 49.0  Chrome 53.0
	
	
【免責等】
	
	このスクリプトによって何らかの損害・不利益が生じた場合、
	作者は責任を負いかねますのでご了承の上ご利用下さい。
	
	改造及び再配布に関しては非商用に限り自由に行って構いません。
	改造された場合はサポート対象外となりますので自己責任でお願いします。
	
	著作権は放棄していません。
	
	
【商用利用】
	
	商用利用（下記参照）の場合はメールにてお問い合わせ下さい。
	
	・スクリプトを有償で第三者にレンタルする場合
	・スクリプトを有償で代行設置する場合
	・スクリプトを組み込んだものを販売する場合
	・その他、スクリプトによって直接的な営利を得る場合
	
	※商用サイト（通販等）で普通に1ユーザーとして利用する場合は
	  商用利用には当たりませんので連絡不要です。
	
	
【雑誌/書籍等への掲載】
	
	このスクリプトを雑誌/書籍等へ掲載（CD-ROM等へ収録）する場合、
	基本的には全て承諾していますが、メールにてご一報頂ければ幸いです。
	
	
【サポート】
	
	このスクリプトを利用するにあたってのサポートは
	配布元のBBS及びメールにて対応しています。
	
	不具合の報告等は必ずスクリプトのバージョンを明記した上で
	出来るだけ「具体的」に書いて頂ければと思います。
	
	PHPのエラーメッセージが表示される場合は必ず併記して下さい。
	
	
【メール対応】
	
	SPAMメール対策としてメールアドレスは非公開です。
	メール対応を希望する場合は配布元のメールフォームより送信願います。
	
	
 ======================================================================
	
 ///// 更新履歴 /////
	
【ver 2.3.0 - 2016/10/12】
	
	・モバイル系端末のUA取得を細分化
	・UA/OS判定を強化（モバイル系UAに対応など）
	・UA（ブラウザ）の3桁バージョンに対応（何桁でもOK）
	・パラメータ「端末機種（モバイル）を追加
	・パラメータ「通信キャリア」を追加」
	・パラメータ「都道府県」を追加
	・トップページの日別パラメータ統計を
	  好きなパラメータで表示出来るよう変更
	
	
【ver 2.2.8 - 2016/09/22】

	・スマホのリストを更新
	・OS Xのリストを更新（macOS Sierraに対応）
	・UA/OS判定を強化（Windows 10 Mobileに対応）
	
	
【ver 2.2.7 - 2015/10/24】
	
	・トレンドマイクロ（ウイルスバスター）からの
	  アクセスをSPAMとして扱い、記録しないよう変更
	
	
【ver 2.2.6 - 2015/09/16】
	
	・OS Xのリストを更新（El Capitanに対応）
	・UA/OS判定を強化（Edge、PS4に対応）
	・.csvダウンロード時にUAの「,」を「.」に変換するよう変更
	
	
【ver 2.2.5 - 2015/04/15】
	
	・スマホのリストを更新
	・UA/OS判定を強化（Windows 10に対応）
	
	
【ver 2.2.4 - 2014/03/12】
	
	・スマホのリストを更新
	・OS Xのリストを更新
	・UA/OS判定を強化（IE11以上に対応）
	
	
【ver 2.2.3 - 2013/06/29】
	
	・スマホのリストを更新
	・スマホのキャリア判定を強化
	・リンク元へのジャンプを以前の直ジャンプ形式に変更
	（リンククッション形式を廃止）
	
	
【ver 2.2.2 - 2012/12/08】
	
	・解析用タグ情報の説明を微妙に変更
	・配布サイトへのリンクを微妙に変更
	
	
【ver 2.2.1 - 2012/10/21】
	
	・conf.iniのcut_url_out設定が反映されないバグを修正
	
	
【ver 2.2.0 - 2012/10/20】
	
	・UA/OS判定を強化（Android＆OS X＆PS3）
	・JavaScriptの処理速度を高速化
	・スマホのリストを更新
	・PHPエラーのブラウザ出力設定をoffに変更
	・フィルターメニューの携帯をモバイルに表記変更
	・フィルターメニューのロボットをbotに表記変更
	・Mac OS X（OS X）を愛称も併記するよう表記変更
	
	
【ver 2.2.0 beta4 - 2012/10/06】
	
	・スマホ用で簡易検索が表示されないバグを修正
	・スマホ用でアドレスバーを隠す機能を実装
	・スマホ用のデザインを微調整
	・スマホ用のログイン画面を修正
	・スマホ用の自動リンク機能をoffにするよう変更
	・IEで常に最新の描画モードを使うよう設定
	・フレームワークのアーキテクチャを変更
	
	
【ver 2.2.0 beta3 - 2012/09/23】
	
	・名称を『Lunasys』から『Lunalys』に変更
	・データ公開機能に「リンク先（クリック）」を追加
	・フレームワークのアーキテクチャを変更
	・ログイン画面のデザインを変更
	・全コードを最適化し処理速度を高速化
	・tracker.js利用だとIEでオーバーレイが表示されないバグを修正
	・スマホ用管理画面を実装
	
	
【ver 2.2.0 beta2 - 2012/08/22】
	
	・fw.iniのgzip圧縮転送設定を削除（常時圧縮）
	・tracker.phpで特定のサーバー環境でIPが取得出来ないバグを修正
	・データ公開機能のreferrerが表示されないバグを修正
	・tracker.jsとadd.jsに記述ミスがあったのを修正
	・Google検索の「not provided」に対応
	・スマホのリストを更新
	
	
【ver 2.2.0 beta1 - 2012/07/07】
	
	・日間パラメータ統計にIPアドレスを追加
	・日間パラメータ統計にリモートホストを追加
	・高速include用tracker.phpを実装
	・.htaccessに圧縮転送用の記述を追記（mod_deflate）
	・tracker.jsとadd.jsのdocument.writeをcreateElementに変更
	・PlayStation Vitaの表記をPSVからPS Vitaに変更
	・conf.iniのURLカット設定をリンク元＆リンク先にも適用するよう変更
	・DBアクセスの例外発生時のリトライ回数制限を実装
	・UA判定に「Blue Coat Proxy」を追加
	・UA判定を強化（Android追加＆Google Web Preview削除）
	・conf.iniにユニークPV可否設定を追加
	
	
【ver 2.1.2 - 2012/05/03】
	
	・ページ番号管理の通常編集でページタイトルが変更出来ないバグを修正
	・ログローテーションをしない設定にすると詳細ログが取得されないバグを修正
	
	
【ver 2.1.1 - 2012/04/07】
	
	・ログテーブルのコンバート時にデータがない場合は実行しないよう変更
	・tracker.jsでリンク元の途中に対象ドメインが含まれていると削除してしまうバグを修正
	・tracker.js呼び出しの時に訪問回数が1に固定されてしまうバグを修正
	
	
【ver 2.1.0 - 2012/04/04】
	
	・詳細ログにUA全文を追加
	・詳細ログにシークエンス番号を追加（管理用）
	・詳細ログでもスマホの機種名を表示するよう変更
	・詳細ログのレイアウト＆デザインを変更
	・管理画面の細部デザインを微調整
	・ロボットのアクセスは同一IP/日でまとめるよう変更
	・検索語の半角カナを全角、全角英数字を半角に変換するよう変更
	・スマホのリストを更新
	・リンク元をページ番号で保存するよう変更
	・ページ情報管理で編集後にデータ領域開放を実行するよう変更
	・詳細ログ検索時のリンク元に&amp;が含まれると表示されないバグを修正
	・詳細ログ条件検索で特定条件下でエラーが出るバグを修正
	・詳細ログ簡易検索で特定条件下でエラーが出るバグを修正
	・リンク元へのジャンプをワンクッション形式に変更
	・リンク元へのジャンプ時に稀に検索語が文字化けするバグを修正
	・conf.iniにログ取得時のUA/IPチェック可否設定を復活
	・conf.iniにアクセスルートの最大保存件数設定を追加
	
	
【ver 2.0.4 - 2012/02/04】
	
	・ページタイトルに特殊文字が含まれていると「undefined」になるバグを修正
	・詳細ログ条件検索でリンク先の検索がエラーが出て表示されないバグを修正
	・2.0.3でページ情報管理のCSVがエラーが出て表示されないバグを修正
	・2.0.3でページ情報管理の全件表示でエラーが出るバグを修正
	・2.0.3で新規設置時にエラーが出てログが取得出来ないバグを修正
	・2.0.3で特定条件下で日付変更がされないバグを修正
	
	
【ver 2.0.3 - 2012/02/01】
	
	・全体的に処理速度を高速化
	・ログ取得部分のクラス設計を大幅に変更
	・「ページ番号管理」を「ページ情報管理」に変更
	・ロボットのアクセスルートを最大10件に制限するよう変更
	・解析タグ情報にRSSフィード用のタグを追記
	・conf.iniのURL整形設定をリンク先にも適用するよう変更
	・conf.iniのspam_not_jp設定の条件をjp|net|comに変更
	・リンク先タイトルが空白文字のみの時に空欄になるバグを修正
	・オーバーレイに文字コード自動判定機能を実装
	・検索エンジン判定を強化（ezsch.ezwebを追加）
	
	
【ver 2.0.2 - 2012/01/25】
	
	・ログ取得時の処理を若干高速化
	・リンク元のドメインチェックを若干変更
	・php.iniのDynamic Extensions関連の記述をコメントアウト
	
	
【ver 2.0.1 - 2012/01/18】
	
	・オーバーレイで特定の条件下でエラーが出るバグを修正
	・HTTPSのページでも正しくデータを取得出来るよう変更
	・conf.iniのドメイン設定の詳細をreadme.txtに追記
	・conf.iniのドメイン設定が空欄だとチェックしないよう変更
	・php.iniにDynamic Extensions関連の記述を追加
	・タイムゾーンをフレームワーク内で設定するように変更
	・タイムゾーン設定をphp.iniからfw.iniに移動
	・グリニッジ標準時の時差設定をconf.iniからfw.iniに移動
	
	
【ver 2.0.0 - 2012/01/12】
	
	・正式版リリース
	・タイムゾーン設定をphp.iniに追加
	・UA偽装のSPAMアクセス除外機能を実装
	・ユニークアクセス判定を IP or ID に変更
	・後追いデータ送信処理を高速化（スリープ処理を廃止）
	・readme.txtに別ドメイン用管理者Cookie発行の記述を追加
	・特定条件下で月別アクセス推移が表示されないバグを修正
	
	
【ver 2.0.0 beta3 - 2011/12/09】
	
	・スマートフォンのリストを更新
	・パラメータの文字数制限アルゴリズムを変更
	・日間パラメータにリンク先/訪問回数を追加
	・ロボット判定を強化（Feedfetcher-Googleを追加）
	・ロボットの簡易検索時にエラーが出るバグを修正
	・UA以外の簡易検索時にロボットを除外するよう変更
	・折れ線グラフの色指定方法を変更
	
	
【ver 2.0.0 beta2 - 2011/11/25】
	
	・稀に検索語がデコードされていない問題を修正
	・ページ遷移が早いと訪問回数が更新されない問題を修正
	・未知の検索エンジンでも検索語を取得出来るよう変更
	・データ公開機能のページ/リンク元にリンクを張るよう変更
	・ダミー画像の出力方式を変更
	・URLの拡張子無し / 補記設定を追加
	・URLのポート番号削除設定を追加
	・URLのwwwサブドメイン削除設定を追加
	
	
【ver 2.0.0 beta1 - 2011/11/11】
	
	・write.phpの呼び出しをimgタグからscriptタグに変更
	・JavaScriptインジェクション対策を強化
	・詳細ログにユニークIDを追加
	・詳細ログに前回訪問日時を追加
	・詳細ログに訪問回数を追加
	・詳細ログにリンク先（クリック）を追加
	・月間パラメータに訪問回数を追加
	・月間パラメータにリンク先（クリック）を追加
	・月間パラメータの円グラフ表示機能を実装
	・月間パラメータの順位変動グラフ表示機能を復活
	・検索キーワードのデフォルト表示をフレーズに変更
	・検索キーワードの全角スペースを半角に変換するよう変更
	・ログテーブルのフォーマットを変更
	・旧ログから新ログへのコンバート機能を実装
	・ロボット判定を強化（.com.ua/.net.uaを追加）
	・検索エンジン判定を強化（babylon.com/conduit.comを追加）
	・詳細ログのユニークID検索を実装
	・オーバーレイ表示機能を復活
	・indexの今日ログ表示機能を実装（検索語＆リンク元）
	・リンク元がiモード検索時のジャンプ先をgooに変更
	・リンク元のURLフィルターを廃止
	・リンク元のドメインフィルターでwwwを余計に付加するバグを修正
	・リンク元ジャンプの時に日本語が文字化けするバグを修正
	・簡易検索時に?が含まれているとヒットしないバグを修正
	
	
【ver 1.0.2 - 2011/08/26】
	
	・ログインIDを変更しても管理者Cookieが更新されないバグを修正
	・サブドメインが違っても管理者Cookieが有効になるよう変更
	・別ドメイン用管理者Cookie発行機能を実装（cookie.php）
	
	
【ver 1.0.1 - 2011/08/12】
	
	・解析用タグ情報に「より正確に解析する設定」を追記
	・URLを取得出来ない時は「Unknown」にするよう変更
	・ロボット判定を強化（Y!J-AGENTを追加）
	・ロボットの省略表記を強化
	・日間パラメータ統計の「全項目」でエラーが出るバグを修正
	・readme.txtに違うドメインに設置に関する記述を追記
	
	
【ver 1.0.0 - 2011/07/29】
	
	・正式版リリース
	・UA/ロボット判定を強化
	・検索エンジン判定を強化
	・conf.iniのjs_tracking切り替え機能を廃止
	・一部環境で検索語が正常に取得出来ないバグを修正
	・tracker.js/add.jsのパス設定が不要になるよう変更
	・スマートフォン/jigの時も機種名をUAにするよう変更
	・「DoCoMo」の表記を「docomo」に変更
	・パラメータ統計のデータ公開機能を復活
	・setup.phpの内容を解析用タグ情報に移行
	
	
【ver 1.0.0 beta4 - 2011/07/01】
	
	・PHPからincludeの時もURLを絶対パスで取得するように変更
	・DBエラー発生時の処理方法を例外処理に変更
	・表示領域が解像度以上にならないよう変更
	・後追いデータ追記機能を実装（add.js）
	・readme.txtに表示の高速化に関する記述を追記
	
	
【ver 1.0.0 beta3 - 2011/06/17】
	
	・ブラウザ統計で全件リンクが表示されないバグを修正
	・ロボットのアクセス時に日付更新されないバグを修正
	・UAの統合フィルターで携帯が入っていないバグを修正
	・トランザクションエラーが発生する問題を修正
	・CSSの@import読み込みをlink要素に変更
	・Valid HTML5 になるよう出力を修正
	・ロボットのアクセスルートを最大20件に制限するよう変更
	・テキストカウンター表示機能を復活
	
	
【ver 1.0.0 beta2 - 2011/06/03】
	
	・別サーバーでページタイトルが取得出来ないバグを修正
	・時間別推移の先頭が表示されないバグを修正
	・IE7でレイアウトが崩れる問題を修正
	・自分のアクセスをカウントしない設定を復活
	・リファラスパムブロック機能を実装
	・mktime関数を自前で計算するように変更
	・SQLiteの接続を「PDO」に変更
	・UA/OS/ロボット判定を強化
	・全コードを最適化し処理速度を高速化
	
	
【ver 1.0.0 beta1 - 2011/05/20】
	
	・jump.phpに依存しない直ジャンプ機能を実装
	・詳細ログの1ページ目タイトル表示機能を実装
	・詳細ログのロボットフィルターを実装
	・詳細ログの携帯フィルターを実装
	・詳細ログのPCフィルターを実装
	・OSの携帯フィルターを実装
	・OSのPCフィルターを実装
	・UAの携帯フィルターを実装
	・UAのPCフィルターを実装
	・UAのロボットフィルターを実装
	・折れ線グラフの表示方式を「Canvas」に統一
	・アクセス推移グラフの別窓表示を廃止
	・UA種別の取得機能を実装
	・UA/OS/ロボット判定を強化
	・検索エンジン判定を強化
	・ログの保存方式を「SQLite」に統一
	・PVのカウント方法を一般的なものに変更
	・分散ログ保存機能を実装
	・インターフェイスを大幅に変更
	・ページ出力を「HTML5」に変更
	
	
